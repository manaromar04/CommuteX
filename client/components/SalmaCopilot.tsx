import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { MessageCircle, Send } from "lucide-react";
import { useState } from "react";

interface Message {
  id: string;
  role: "user" | "assistant";
  content: string;
  timestamp: Date;
}

interface SalmaCopilotProps {
  isFloating?: boolean;
}

export function SalmaCopilot({ isFloating = false }: SalmaCopilotProps) {
  const [messages, setMessages] = useState<Message[]>([
    {
      id: "1",
      role: "assistant",
      content:
        "Hi! I'm Salma, your AI Copilot. I'm here to help you with trip planning, reward guidance, and smart commuting tips. What can I help you with today?",
      timestamp: new Date(),
    },
  ]);
  const [input, setInput] = useState("");

  const handleSendMessage = () => {
    if (!input.trim()) return;

    const userMessage: Message = {
      id: Math.random().toString(),
      role: "user",
      content: input,
      timestamp: new Date(),
    };

    setMessages((prev) => [...prev, userMessage]);
    setInput("");

    // Simulate AI response
    setTimeout(() => {
      const responses = [
        "Great question! For carpool trips with 3+ passengers, you can earn 80 reward points. That's a great way to build your tier!",
        "I'd recommend checking the Smart Hubs section for available Park & Ride locations. You'll earn 40 points for each Park & Ride booking!",
        "Your current wallet balance allows for several trips. Would you like me to suggest some upcoming carpool options?",
        "The forecast shows good commuting conditions tomorrow morning. Would you like to book a trip?",
      ];

      const response: Message = {
        id: Math.random().toString(),
        role: "assistant",
        content: responses[Math.floor(Math.random() * responses.length)],
        timestamp: new Date(),
      };

      setMessages((prev) => [...prev, response]);
    }, 500);
  };

  const cardClasses = isFloating
    ? "h-full flex flex-col bg-card border-0"
    : "h-full flex flex-col";

  return (
    <Card className={cardClasses}>
      {!isFloating && (
        <CardHeader>
          <div className="flex items-center gap-2">
            <MessageCircle className="h-5 w-5 text-primary" />
            <div>
              <CardTitle>Salma AI Copilot</CardTitle>
              <CardDescription>Your smart commuting assistant</CardDescription>
            </div>
          </div>
        </CardHeader>
      )}
      {isFloating && (
        <div className="px-4 py-3 border-b border-border bg-card">
          <div className="flex items-center gap-2">
            <MessageCircle className="h-4 w-4 text-primary" />
            <h2 className="font-semibold text-foreground text-sm">Salma</h2>
          </div>
        </div>
      )}
      <CardContent className="flex-1 flex flex-col overflow-hidden">
        <div className="flex-1 overflow-y-auto space-y-3 mb-3 pr-2">
          {messages.map((message) => (
            <div
              key={message.id}
              className={`flex ${
                message.role === "user" ? "justify-end" : "justify-start"
              }`}
            >
              <div
                className={`max-w-xs rounded-lg px-3 py-2 text-sm ${
                  message.role === "user"
                    ? "bg-primary text-primary-foreground"
                    : "bg-muted text-muted-foreground"
                }`}
              >
                {message.content}
              </div>
            </div>
          ))}
        </div>

        <div className="flex gap-2">
          <input
            type="text"
            placeholder="Ask Salma..."
            value={input}
            onChange={(e) => setInput(e.target.value)}
            onKeyPress={(e) => {
              if (e.key === "Enter") {
                handleSendMessage();
              }
            }}
            className="flex-1 rounded-lg border border-border bg-background px-3 py-2 text-sm text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary"
          />
          <Button
            size="icon"
            onClick={handleSendMessage}
            disabled={!input.trim()}
            className="rounded-lg h-9 w-9"
          >
            <Send className="h-4 w-4" />
          </Button>
        </div>
      </CardContent>
    </Card>
  );
}
